# tarea-bd2-api-agregar-usuarios
Lo primero que hice fue configurar el entorno del backend. Usé uv sync para instalar todas las dependencias del proyecto que estaban en el pyproject.toml. Decidí trabajar con SQLite en lugar de PostgreSQL porque es más simple para desarrollo, así que modifiqué el archivo .env cambiando la URL de conexión a sqlite:///./bd2_library.db y actualicé app/config.py para que usara SQLite por defecto. Tuve un pequeño problema con el nombre de la variable del secreto JWT - estaba como JWT_SECRET_KEY en el .env pero el código esperaba JWT_SECRET, así que lo corregí.
Después creé todos los controladores que faltaban. Implementé app/controllers/user.py con un UserController completo que maneja todas las operaciones CRUD de usuarios. Lo importante aquí fue agregar exclude_from_auth=True al endpoint de creación de usuarios para que cualquiera pudiera registrarse sin necesitar un token primero. También creé los controladores de autenticación, libros y préstamos siguiendo la misma estructura. El controlador de autenticación en app/controllers/auth.py implementa el login que verifica las contraseñas hasheadas con Argon2 y devuelve tokens JWT.
En cuanto a los DTOs, configuré diferentes versiones en app/dtos/user.py: uno para leer usuarios que excluye la contraseña, otro para crear usuarios que excluye los campos autogenerados, y otro para actualizaciones parciales. Esto asegura que cada endpoint solo maneje los datos apropiados. Los repositorios usan SQLAlchemySyncRepository y el de usuarios tiene un método especial add_with_hashed_password que automáticamente hashea las contraseñas antes de guardarlas.
Un desafío importante fue configurar CORS. Cuando el frontend intentaba comunicarse con el backend, el navegador bloqueaba las peticiones porque corrían en puertos diferentes (5173 para frontend, 8000 para backend). Lo resolví agregando CORSConfig en app/__init__.py para permitir explícitamente peticiones desde el origen del frontend.
Ejecuté las migraciones con uv run alembic upgrade head que creó la base de datos SQLite con todas las tablas necesarias. Probé que todo funcionara creando usuarios de prueba (cris y catalina) usando curl desde la terminal y verificando que el login devolviera tokens JWT correctos.
En el frontend, actualicé src/interfaces.ts para agregar la interface UserCreate que incluye el campo de contraseña. Luego implementé la función registerUser en src/api/index.ts que hace peticiones POST al endpoint /users del backend con los datos en JSON.
Creé el componente RegisterForm.vue que es un formulario completo con validaciones: verifica que todos los campos estén llenos, que las contraseñas coincidan y que tengan al menos 6 caracteres. Incluí toggles para mostrar/ocultar contraseñas y manejo de errores. Cuando el registro es exitoso, automáticamente redirige al login. También creé RegisterView.vue que simplemente renderiza este formulario y agregué la ruta /register en el router.
Para mejorar la experiencia de usuario, modifiqué LoginForm.vue agregando un botón "¿No tienes cuenta? Regístrate aquí" que redirige a la página de registro. De esta manera los usuarios nuevos pueden encontrar fácilmente cómo crear una cuenta sin escribir la URL manualmente.
Probé todo el flujo completo: me registré desde el frontend con el usuario "test", fui redirigido al login automáticamente, ingresé mis credenciales, recibí el token JWT, y pude ver la lista de usuarios donde aparecían tanto cris como catalina que había creado antes. Todo funcionó perfectamente.
